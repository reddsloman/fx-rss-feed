name: Fetch EUR/USD price

on:
  workflow_dispatch:

jobs:
  fetch-price:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch EUR/USD price
        run: |
          echo "Fetching EUR/USD price..."
          RESPONSE=$(curl -s "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=EUR&to_currency=USD&apikey=${{ secrets.ALPHA_VANTAGE_API_KEY }}")
          
          echo "Raw API response:"
          echo "$RESPONSE"

          RATE=$(echo "$RESPONSE" | jq -r '."Realtime Currency Exchange Rate"."5. Exchange Rate"')
          
          if [ "$RATE" = "null" ] || [ -z "$RATE" ]; then
            echo "❌ Could not parse rate from Alpha Vantage response"
            exit 1
          else
            echo "✅ EUR/USD exchange rate: $RATE"
          fi
